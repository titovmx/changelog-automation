name: auto-changelog
on:
  pull_request:
    types: [opened]
jobs:
  add_changelog:
    runs-on: ubuntu-latest
    env:
      changelog_filename: CHANGELOG.md
    steps:
    - name: Checkout repo 
      uses: actions/checkout@v3
      with:
        ref: ${{ github.event.pull_request.head.sha }}
    - name: Check for existing file
      run: test -f ./changelog.md || touch CHANGELOG.md
    - name: Add version and PR title at the beginning
      run: echo "PATCH\n${{github.event.pull_request.title}}\n\n" | cat - $changelog_filename > temp && mv temp $changelog_filename
    - name: Commit changelog
      run: |
        git config --global user.name ${{github.event.sender.name}}
        git config --global user.email ${{github.event.sender.email}}
        git commit -am "Automated Changelog"
        git push
